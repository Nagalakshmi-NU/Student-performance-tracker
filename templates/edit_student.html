{% extends 'base.html' %}
{% block content %}
<h2>Edit Student: {{ student.name }} ({{ student.roll_number }})</h2>
<form method="post" class="row g-3">
  <div class="col-md-6">
    <label class="form-label">Name</label>
    <input name="name" value="{{ student.name }}" class="form-control" required>
  </div>
  <div class="col-12">
    <h5>Subjects & Marks</h5>
    <div id="subjects">
      {% for sub, score in student.grades.items() %}
      <div class="row g-2 mb-2 subject-row">
        <div class="col"><input name="subject[]" value="{{ sub }}" class="form-control" placeholder="Subject"></div>
        <div class="col"><input name="marks[]" type="number" step="0.01" min="0" max="100" class="form-control" value="{{ score }}" placeholder="Marks"></div>
        <div class="col-auto"><button type="button" class="btn btn-danger remove-subject">Remove</button></div>
      </div>
      {% endfor %}
    </div>
    <button type="button" id="add-sub" class="btn btn-secondary">Add More Subject</button>
  </div>
  <div class="col-12">
    <button class="btn btn-primary">Update</button>
  </div>
</form>

<script>
document.getElementById('add-sub').addEventListener('click', function(){
  const container = document.getElementById('subjects');
  const div = document.createElement('div');
  div.className = 'row g-2 mb-2 subject-row';
  div.innerHTML = '<div class="col"><input name="subject[]" class="form-control" placeholder="Subject"></div>' +
                  '<div class="col"><input name="marks[]" type="number" step="0.01" min="0" max="100" class="form-control" placeholder="Marks"></div>' +
                  '<div class="col-auto"><button type="button" class="btn btn-danger remove-subject">Remove</button></div>';
  container.appendChild(div);
});
document.addEventListener('click', function(e){
  if(e.target && e.target.classList.contains('remove-subject')){
    e.target.closest('.subject-row').remove();
  }
});
</script>
{% endblock %}
